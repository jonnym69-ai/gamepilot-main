var g=Object.defineProperty;var h=(n,t,s)=>t in n?g(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var d=(n,t,s)=>(h(n,typeof t!="symbol"?t+"":t,s),s);var e=(n=>(n.STEAM="steam",n.XBOX="xbox",n.PLAYSTATION="playstation",n.NINTENDO="nintendo",n.EPIC="epic",n.GOG="gog",n.ORIGIN="origin",n.UPLAY="uplay",n.BATTLENET="battlenet",n.DISCORD="discord",n.ITCH="itch",n.HUMBLE="humble",n.CUSTOM="custom",n.RETROARCH="retroarch",n.DOLPHIN="dolphin",n.PROJECT64="project64",n.PCSX2="pcsx2",n.RPCS3="rpcs3",n.CEMU="cemu",n.YUZU="yuzu",n.RYUJINX="ryujinx",n.MAME="mame",n.DOSBOX="dosbox",n.SCUMMVM="scummvm",n.VITA3K="vita3k",n.XEMU="xemu",n.MELONDS="melonds",n.PPSSPP="ppsspp",n.CITRA="citra",n.DESMUME="desmume",n))(e||{});const c={[e.RETROARCH]:[".zip",".7z",".rar",".nes",".snes",".gb",".gbc",".gba",".nds",".n64",".psx",".ps2",".iso",".bin",".cue"],[e.DOLPHIN]:[".iso",".gcz",".gcm",".wbfs",".wad",".rvz"],[e.PROJECT64]:[".z64",".n64",".v64",".rom",".zip"],[e.PCSX2]:[".iso",".bin",".img",".mds",".z"],[e.RPCS3]:[".iso",".bin",".img",".ps3"],[e.CEMU]:[".wud",".wux",".iso",".rpx"],[e.YUZU]:[".nsp",".xci",".nca"],[e.RYUJINX]:[".nsp",".xci",".nca"],[e.MAME]:[".zip",".7z",".chd",".cue",".bin"],[e.DOSBOX]:[".exe",".com",".bat",".conf"],[e.SCUMMVM]:[".scummvm",".exe",".com"],[e.VITA3K]:[".vpk",".zip"],[e.XEMU]:[".iso",".xiso",".cso",".z"],[e.MELONDS]:[".nds",".zip",".7z"],[e.PPSSPP]:[".iso",".cso",".pbp",".elf"],[e.CITRA]:[".3ds",".3dsx",".cia",".cxi"],[e.DESMUME]:[".nds",".zip"],[e.STEAM]:[],[e.XBOX]:[],[e.PLAYSTATION]:[],[e.NINTENDO]:[],[e.EPIC]:[],[e.GOG]:[],[e.ORIGIN]:[],[e.UPLAY]:[],[e.BATTLENET]:[],[e.DISCORD]:[],[e.ITCH]:[],[e.HUMBLE]:[],[e.CUSTOM]:[]},p=[{platform:e.RETROARCH,name:"RetroArch",romExtensions:c[e.RETROARCH],supportedSystems:["NES","SNES","GB","GBC","GBA","N64","PS1","Genesis","Arcade"],defaultArgs:["--fullscreen"]},{platform:e.DOLPHIN,name:"Dolphin",romExtensions:c[e.DOLPHIN],supportedSystems:["GameCube","Wii"],defaultArgs:["-b","-e"]},{platform:e.PROJECT64,name:"Project64",romExtensions:c[e.PROJECT64],supportedSystems:["Nintendo 64"],defaultArgs:[]},{platform:e.PCSX2,name:"PCSX2",romExtensions:c[e.PCSX2],supportedSystems:["PlayStation 2"],defaultArgs:["--fullscreen"]},{platform:e.CEMU,name:"Cemu",romExtensions:c[e.CEMU],supportedSystems:["Wii U"],defaultArgs:["-f"]},{platform:e.YUZU,name:"Yuzu",romExtensions:c[e.YUZU],supportedSystems:["Nintendo Switch"],defaultArgs:[]},{platform:e.RYUJINX,name:"Ryujinx",romExtensions:c[e.RYUJINX],supportedSystems:["Nintendo Switch"],defaultArgs:[]},{platform:e.MAME,name:"MAME",romExtensions:c[e.MAME],supportedSystems:["Arcade"],defaultArgs:[]},{platform:e.DOSBOX,name:"DOSBox",romExtensions:c[e.DOSBOX],supportedSystems:["DOS"],defaultArgs:[]},{platform:e.SCUMMVM,name:"ScummVM",romExtensions:c[e.SCUMMVM],supportedSystems:["Point & Click Adventure"],defaultArgs:["--fullscreen"]},{platform:e.PPSSPP,name:"PPSSPP",romExtensions:c[e.PPSSPP],supportedSystems:["PlayStation Portable"],defaultArgs:[]},{platform:e.CITRA,name:"Citra",romExtensions:c[e.CITRA],supportedSystems:["Nintendo 3DS"],defaultArgs:[]},{platform:e.DESMUME,name:"DeSmuME",romExtensions:c[e.DESMUME],supportedSystems:["Nintendo DS"],defaultArgs:[]}];class f{async scanDirectory(t,s){const r={games:[],errors:[],scannedFiles:0,foundGames:0};try{const a=await this.getFilesInDirectory(t);r.scannedFiles=a.length;const o=s||Object.keys(c);for(const u of a){const i=this.getFileExtension(u.name),l=this.detectPlatformForExtension(i,o);if(l){const m=await this.createGameFromRom(u,l);r.games.push(m),r.foundGames++}}}catch(a){r.errors.push(`Failed to scan directory: ${a}`)}return r}async getFilesInDirectory(t){return new DataTransfer().files}getFileExtension(t){const s=t.lastIndexOf(".");return s!==-1?t.substring(s).toLowerCase():""}detectPlatformForExtension(t,s){for(const r of s){const a=c[r];if(a&&a.includes(t))return r}return null}async createGameFromRom(t,s){const r=p.find(l=>l.platform===s),a=t.name.replace(/\.[^/.]+$/,""),o=this.extractGameMetadata(a);return{...{id:`${s}-${t.name}`,title:o.title||a,description:o.description||`A ${(r==null?void 0:r.supportedSystems[0])||s} game`,platforms:[{code:s,name:(r==null?void 0:r.name)||s,icon:`/platforms/${s}.png`}],genres:o.genres||[],tags:o.tags||["Retro",(r==null?void 0:r.supportedSystems[0])||"Emulated"],coverImage:o.coverImage||"/assets/default-rom-cover.jpg",playStatus:"unplayed",isFavorite:!1,addedAt:new Date,hoursPlayed:0,userRating:void 0,globalRating:void 0,releaseYear:o.releaseYear,subgenres:[],emotionalTags:[]},romPath:t.path||"",emulatorConfig:r,fileSize:t.size}}extractGameMetadata(t){const s=t.replace(/\((USA|EUR|JPN|World|NTSC|PAL)\)/gi,"").replace(/\(Rev\s*[0-9]+\)/gi,"").replace(/\[.*?\]/g,"").replace(/\.(v[0-9]+|Rev\s*[0-9]+|Beta|Alpha|Demo)/gi,"").trim(),r=s.match(/\((19|20)\d{2}\)/),a=r?parseInt(r[0].slice(1,-1)):void 0;return{title:s.replace(/\(\d{4}\)/g,"").trim(),releaseYear:a,tags:["Retro","Emulated"]}}getEmulatorConfig(t){return p.find(s=>s.platform===t)}getSupportedPlatforms(){return p.map(t=>t.platform)}isEmulatorPlatform(t){return this.getSupportedPlatforms().includes(t)}}const E=new f;class A{constructor(){d(this,"configs",new Map)}setConfigs(t){this.configs.clear(),t.forEach(s=>{this.configs.set(s.platform,s)})}async launchGame(t,s={}){var a,o;const r={success:!1,launchedAt:new Date};try{const u=(o=(a=t.platforms)==null?void 0:a[0])==null?void 0:o.code;if(!u||!E.isEmulatorPlatform(u))return r.error="Game is not an emulator game",r;const i=this.configs.get(u);if(!i||!i.executablePath)return r.error=`Emulator not configured for ${u}`,r;const l=t.romPath||s.romPath;if(!l)return r.error="ROM path not found",r;const m=this.buildLaunchCommand(i,l,s),S=await this.executeLaunchCommand(m);r.success=!0,r.processId=S}catch(u){r.error=`Failed to launch game: ${u}`,console.error("Launch error:",u)}return r}buildLaunchCommand(t,s,r){const a=[t.executablePath];if(t.defaultArgs&&a.push(...t.defaultArgs),r.customArgs&&a.push(...r.customArgs),r.fullscreen){const o=this.getFullscreenArg(t.platform);o&&a.push(o)}return a.push(s),a}getFullscreenArg(t){return{[e.RETROARCH]:"--fullscreen",[e.DOLPHIN]:"-b",[e.PROJECT64]:"--fullscreen",[e.PCSX2]:"--fullscreen",[e.CEMU]:"-f",[e.YUZU]:"--fullscreen",[e.RYUJINX]:"--fullscreen",[e.MAME]:"--fullscreen",[e.DOSBOX]:"--fullscreen",[e.SCUMMVM]:"--fullscreen",[e.PPSSPP]:"--fullscreen",[e.CITRA]:"--fullscreen",[e.DESMUME]:"--fullscreen",[e.STEAM]:"",[e.XBOX]:"",[e.PLAYSTATION]:"",[e.NINTENDO]:"",[e.EPIC]:"",[e.GOG]:"",[e.ORIGIN]:"",[e.UPLAY]:"",[e.BATTLENET]:"",[e.DISCORD]:"",[e.ITCH]:"",[e.HUMBLE]:"",[e.CUSTOM]:"",[e.RPCS3]:"",[e.VITA3K]:"",[e.XEMU]:"",[e.MELONDS]:""}[t]||null}async executeLaunchCommand(t){try{console.log("ðŸŽ® Launching emulator:",t.join(" ")),await new Promise(r=>setTimeout(r,1e3));const s=`emu_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return console.log("âœ… Emulator launched with PID:",s),s}catch(s){throw console.error("âŒ Failed to launch emulator:",s),new Error(`Failed to launch emulator: ${s}`)}}isConfigured(t){const s=this.configs.get(t);return!!(s&&s.executablePath)}getConfiguredEmulators(){return Array.from(this.configs.keys()).filter(t=>this.isConfigured(t))}async testEmulator(t){const s={success:!1,launchedAt:new Date};try{const r=this.configs.get(t);if(!r||!r.executablePath)return s.error=`Emulator not configured for ${t}`,s;const a=[r.executablePath,"--help"],o=await this.executeLaunchCommand(a);s.success=!0,s.processId=o}catch(r){s.error=`Failed to test emulator: ${r}`}return s}getLaunchCommandPreview(t,s={}){var u,i;const r=(i=(u=t.platforms)==null?void 0:u[0])==null?void 0:i.code;if(!r||!E.isEmulatorPlatform(r))return[];const a=this.configs.get(r);if(!a)return[];const o=t.romPath||s.romPath||"<ROM_PATH>";return this.buildLaunchCommand(a,o,s)}}const O=new A;export{e as P,O as a,E as e};
